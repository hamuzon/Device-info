<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Device-info</title>
  <link id="favicon" rel="icon" type="image/png" href="icon-dark.png" />
  <meta name="theme-color" content="#001b33" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <style>
    :root {
      --bg-dark: #001b33;
      --bg-light: #ffffff;
      --text-dark: #a3c4f3;
      --text-light: #0a1a33;
      --accent-dark: #4da6ff;
      --accent-light: #1a5fff;
      --font-mono: 'Share Tech Mono', monospace;
    }
    body {
      margin: 0;
      font-family: var(--font-mono);
      background-color: var(--bg-dark);
      color: var(--text-dark);
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0 1rem 2rem;
    }
    body.light {
      background-color: var(--bg-light);
      color: var(--text-light);
    }
    header {
      max-width: 700px;
      width: 100%;
      margin: 1rem auto 1.5rem;
      font-size: 0.9rem;
      line-height: 1.4;
      background: rgba(0, 116, 217, 0.15);
      border-radius: 12px;
      padding: 0.6rem 1rem;
      color: var(--accent-dark);
      user-select: none;
      font-weight: 600;
    }
    body.light header {
      background: rgba(26, 95, 255, 0.15);
      color: var(--accent-light);
    }
    h1 {
      margin: 0 0 1rem;
      font-size: 1.8rem;
      text-align: center;
      user-select: none;
    }
    .controls {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .controls button {
      font-family: var(--font-mono);
      padding: 0.5rem 1rem;
      border: 2px solid var(--accent-dark);
      background: transparent;
      color: var(--text-dark);
      cursor: pointer;
      border-radius: 8px;
      transition: 0.3s;
      user-select: none;
    }
    body.light .controls button {
      border-color: var(--accent-light);
      color: var(--text-light);
    }
    .controls button.active {
      background: var(--accent-dark);
      color: #fff;
    }
    body.light .controls button.active {
      background: var(--accent-light);
    }
    table {
      width: 100%;
      max-width: 700px;
      border-collapse: collapse;
      margin-bottom: 2rem;
      table-layout: fixed;
      word-wrap: break-word;
      background: #121c33;
      color: var(--text-dark);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
    }
    body.light table {
      background: #f9f9f9;
      color: var(--text-light);
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 0.6rem 1rem;
      border-bottom: 1px solid #444;
      text-align: left;
      word-break: break-word;
      vertical-align: top;
    }
    body.light th, body.light td {
      border-color: #ccc;
    }
    th {
      font-weight: bold;
      width: 35%;
      user-select: none;
      background: rgba(0, 116, 217, 0.3);
      color: white;
    }
    body.light th {
      background: rgba(26, 95, 255, 0.3);
      color: #003366;
    }
    tr {
      animation: fadeIn 0.4s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    footer {
      font-size: 0.85rem;
      text-align: center;
      margin-top: auto;
      padding-top: 1rem;
      user-select: none;
      color: #888;
    }
    footer a {
      color: inherit;
      text-decoration: underline;
    }
    footer a:hover {
      text-decoration: none;
    }
    @media (max-width: 480px) {
      h1 {
        font-size: 1.5rem;
      }
      .controls button {
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
      }
      th, td {
        padding: 0.4rem 0.8rem;
      }
      header {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <header id="header-info" aria-label="IP and Libraries info"></header>

  <h1 id="title">Device-info</h1>

  <div class="controls" role="group" aria-label="Language and Mode Switch">
    <button id="btn-ja" type="button" aria-pressed="true" class="active">日本語</button>
    <button id="btn-en" type="button" aria-pressed="false">English</button>
    <button id="btn-light" type="button" aria-pressed="false">ライト</button>
    <button id="btn-dark" type="button" aria-pressed="true" class="active">ダーク</button>
  </div>

  <table id="info" role="table" aria-label="Device Information"></table>

  <footer>
    © 2025 <a href="https://device-info.hamusata.f5.si" target="_blank" rel="noopener">device-info.hamusata.f5.si</a><br />
    表示される情報は一部、正確でない可能性があります。
  </footer>

  <script>
    (function () {
      const dict = {
        ja: {
          title: "デバイス情報",
          os: "OS名",
          version: "バージョン",
          device: "端末名",
          browser: "ブラウザ",
          ua: "ユーザーエージェント",
          screen: "画面解像度",
          viewport: "ビューポート",
          colorDepth: "色深度",
          pixelDepth: "ピクセル深度",
          cpu: "CPUコア数",
          memory: "メモリ",
          ipv4: "IPv4アドレス",
          ipv6: "IPv6アドレス",
          ip: "現在使用IP",
          online: "オンライン状態",
          fetchedAt: "取得時刻",
          now: "現在時刻",
          timezone: "タイムゾーン",
          unknown: "不明",
          online_yes: "オンライン",
          online_no: "オフライン"
        },
        en: {
          title: "Device Info",
          os: "OS",
          version: "Version",
          device: "Device",
          browser: "Browser",
          ua: "User Agent",
          screen: "Screen",
          viewport: "Viewport",
          colorDepth: "Color Depth",
          pixelDepth: "Pixel Depth",
          cpu: "CPU Cores",
          memory: "Memory",
          ipv4: "IPv4",
          ipv6: "IPv6",
          ip: "Current IP",
          online: "Online",
          fetchedAt: "Fetched At",
          now: "Now",
          timezone: "Timezone",
          unknown: "Unknown",
          online_yes: "Online",
          online_no: "Offline"
        }
      };

      // ローカル保存復元
      let currentLang = localStorage.getItem("lang") || "ja";
      let darkMode = localStorage.getItem("mode") === "dark" || 
        (localStorage.getItem("mode") === null && window.matchMedia('(prefers-color-scheme: dark)').matches);

      const table = document.getElementById('info');
      const favicon = document.getElementById('favicon');
      const btnJa = document.getElementById('btn-ja');
      const btnEn = document.getElementById('btn-en');
      const btnLight = document.getElementById('btn-light');
      const btnDark = document.getElementById('btn-dark');
      const titleEl = document.getElementById('title');
      const headerEl = document.getElementById('header-info');

      // OS検出
      function detectOS() {
        const ua = navigator.userAgent;
        if (/Android/.test(ua)) {
          const version = (ua.match(/Android\s+([\d.]+)/) || [])[1] || dict[currentLang].unknown;
          const model = (ua.match(/;\s?([^;\/]+)\s+Build/i) || [])[1] || dict[currentLang].unknown;
          return { name: "Android", version, device: model };
        }
        if (/iPhone|iPad|iPod/.test(ua)) {
          const version = (ua.match(/OS (\d+)[_.](\d+)/) || [])[1] || dict[currentLang].unknown;
          const model = /iPhone/.test(ua) ? "iPhone" : "iPad";
          return { name: model === "iPhone" ? "iOS" : "iPadOS", version, device: model };
        }
        if (/Windows NT/.test(ua)) {
          const ver = (ua.match(/Windows NT ([\d.]+)/) || [])[1];
          const map = {
            "10.0": "10 / 11",
            "6.3": "8.1",
            "6.2": "8",
            "6.1": "7",
            "6.0": "Vista",
            "5.1": "XP"
          };
          return { name: "Windows", version: map[ver] || ver || dict[currentLang].unknown, device: "PC" };
        }
        if (/Mac OS X/.test(ua)) {
          const version = (ua.match(/Mac OS X (\d+[_\.]\d+)/) || [])[1]?.replace(/_/g, ".") || dict[currentLang].unknown;
          return { name: "macOS", version, device: "Mac" };
        }
        if (/Linux/.test(navigator.platform)) {
          return { name: dict[currentLang].unknown, version: dict[currentLang].unknown, device: "Linux端末" };
        }
        return { name: dict[currentLang].unknown, version: dict[currentLang].unknown, device: dict[currentLang].unknown };
      }

      // ブラウザ検出
      function getBrowser() {
        const ua = navigator.userAgent;
        if (/Edg\//.test(ua)) return "Microsoft Edge";
        if (/OPR\//.test(ua)) return "Opera";
        if (/Chrome\//.test(ua)) return "Chrome";
        if (/Firefox\//.test(ua)) return "Firefox";
        if (/Safari/.test(ua) && !/Chrome/.test(ua)) return "Safari";
        return dict[currentLang].unknown;
      }

      // 表作成補助
      function createRow(label, value) {
        const row = document.createElement('tr');
        row.innerHTML = `<th scope="row">${label}</th><td>${value}</td>`;
        return row;
      }

      // IP取得(ipify API)
      async function fetchIPData() {
        const ipv4 = await fetch('https://api.ipify.org?format=json')
          .then(res => res.json())
          .then(data => data.ip || dict[currentLang].unknown)
          .catch(() => dict[currentLang].unknown);

        const ipv6 = await fetch('https://api64.ipify.org?format=json')
          .then(res => res.json())
          .then(data => data.ip || dict[currentLang].unknown)
          .catch(() => dict[currentLang].unknown);

        const currentIP = ipv6 && ipv6 !== dict[currentLang].unknown ? ipv6 : ipv4;
        return { ipv4, ipv6, currentIP };
      }

      // 情報更新
      async function updateInfo() {
        const lang = dict[currentLang];
        table.innerHTML = '';

        const ua = navigator.userAgent;
        const osInfo = detectOS();
        const browser = getBrowser();
        const { ipv4, ipv6, currentIP } = await fetchIPData();

        const cpuCores = navigator.hardwareConcurrency || lang.unknown;
        const rawMemory = navigator.deviceMemory;
        const memory = (typeof rawMemory === 'number' && rawMemory > 0)
          ? `${rawMemory % 1 === 0 ? rawMemory : rawMemory.toFixed(1)} GB`
          : lang.unknown;

        const screenRes = `${screen.width} x ${screen.height}`;
        const viewport = `${window.innerWidth} x ${window.innerHeight}`;
        const colorDepth = screen.colorDepth;
        const pixelDepth = screen.pixelDepth;
        const fetchedAt = new Date();
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || lang.unknown;
        const onlineStatus = navigator.onLine ? lang.online_yes : lang.online_no;

        const infoList = [
          [lang.os, osInfo.name],
          [lang.version, osInfo.version],
          [lang.device, osInfo.device],
          [lang.browser, browser],
          [lang.ua, ua],
          [lang.screen, screenRes],
          [lang.viewport, viewport],
          [lang.colorDepth, colorDepth],
          [lang.pixelDepth, pixelDepth],
          [lang.cpu, cpuCores],
          [lang.memory, memory],
          [lang.ipv4, ipv4],
          [lang.ipv6, ipv6],
          [lang.ip, currentIP],
          [lang.online, onlineStatus],
          [lang.fetchedAt, fetchedAt.toLocaleString()],
          [lang.now, ''],
          [lang.timezone, timezone]
        ];

        for (const [label, value] of infoList) {
          table.appendChild(createRow(label, value));
        }

        headerEl.innerHTML = `IPv4: ipify (https://api.ipify.org) | IPv6: ipify (https://api64.ipify.org) | 現在IP: ${currentIP}<br>使用ライブラリ: ipify API, JavaScript Web API`;
      }

      // 現在時刻更新
      function updateCurrentTime() {
        const nowStr = new Date().toLocaleString();
        const rows = table.querySelectorAll('tr');
        for (const row of rows) {
          if (row.firstElementChild?.textContent === dict[currentLang].now) {
            row.lastElementChild.textContent = nowStr;
            break;
          }
        }
      }

      // 言語設定変更
      function setLang(lang) {
        currentLang = lang;
        localStorage.setItem("lang", lang);
        titleEl.textContent = dict[lang].title;
        btnJa.classList.toggle('active', lang === 'ja');
        btnEn.classList.toggle('active', lang === 'en');
        btnJa.setAttribute('aria-pressed', lang === 'ja');
        btnEn.setAttribute('aria-pressed', lang === 'en');
        updateInfo();
      }

      // モード切替
      function setMode(isDark) {
        darkMode = isDark;
        localStorage.setItem("mode", isDark ? "dark" : "light");
        document.body.classList.toggle('light', !darkMode);
        btnLight.classList.toggle('active', !darkMode);
        btnDark.classList.toggle('active', darkMode);
        btnLight.setAttribute('aria-pressed', !darkMode);
        btnDark.setAttribute('aria-pressed', darkMode);
        favicon.href = isDark ? 'icon-dark.png' : 'icon-light.png';
      }

      // イベントリスナー
      btnJa.addEventListener('click', () => setLang('ja'));
      btnEn.addEventListener('click', () => setLang('en'));
      btnLight.addEventListener('click', () => setMode(false));
      btnDark.addEventListener('click', () => setMode(true));

      // 初期設定実行
      setMode(darkMode);
      setLang(currentLang);

      // 時刻は1秒毎更新
      setInterval(updateCurrentTime, 1000);
    })();
  </script>
</body>
</html>
