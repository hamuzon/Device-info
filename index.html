<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Device Info</title>
  <link id="favicon" rel="icon" type="image/png" href="icon-dark.png" />
  <style>
    :root {
      --bg-dark: #001b33;
      --bg-light: #ffffff;
      --text-dark: #a3c4f3;
      --text-light: #0a1a33;
      --accent-dark: #4da6ff;
      --accent-light: #1a5fff;
      --font-mono: 'Share Tech Mono', monospace;
    }

    body {
      margin: 0;
      font-family: var(--font-mono);
      background-color: var(--bg-dark);
      color: var(--text-dark);
      transition: background 0.3s, color 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      min-height: 100vh;
    }
    body.light {
      background-color: var(--bg-light);
      color: var(--text-light);
    }

    h1 {
      margin-bottom: 1rem;
      font-size: 1.8rem;
      text-align: center;
      user-select: none;
    }

    .controls {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .controls button {
      font-family: var(--font-mono);
      padding: 0.5rem 1rem;
      border: 2px solid var(--accent-dark);
      background: transparent;
      color: var(--text-dark);
      cursor: pointer;
      border-radius: 8px;
      transition: 0.3s;
      user-select: none;
    }
    body.light .controls button {
      border-color: var(--accent-light);
      color: var(--text-light);
    }
    .controls button.active {
      background: var(--accent-dark);
      color: #fff;
    }
    body.light .controls button.active {
      background: var(--accent-light);
    }

    table {
      width: 100%;
      max-width: 700px;
      border-collapse: collapse;
      margin-bottom: 2rem;
      table-layout: fixed;
      word-wrap: break-word;
    }
    th, td {
      padding: 0.6rem 1rem;
      border-bottom: 1px solid #444;
      text-align: left;
      word-break: break-word;
      vertical-align: top;
    }
    body.light th, body.light td {
      border-color: #888;
    }
    th {
      font-weight: bold;
      width: 35%;
      user-select: none;
    }

    footer {
      font-size: 0.85rem;
      text-align: center;
      margin-top: auto;
      padding-top: 1rem;
      user-select: none;
    }
    footer a {
      color: inherit;
      text-decoration: underline;
    }
    footer a:hover {
      text-decoration: none;
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.5rem;
      }
      .controls button {
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
      }
      th, td {
        padding: 0.4rem 0.8rem;
      }
    }
  </style>
</head>
<body>
  <h1 id="title">デバイス情報</h1>
  <div class="controls" role="group" aria-label="言語選択とモード切替">
    <button id="btn-ja" class="active" aria-pressed="true" type="button">日本語</button>
    <button id="btn-en" aria-pressed="false" type="button">English</button>
    <button id="btn-light" aria-pressed="false" type="button">ライト</button>
    <button id="btn-dark" class="active" aria-pressed="true" type="button">ダーク</button>
  </div>

  <table id="info" role="table" aria-label="デバイス情報"></table>

  <footer>
    © 2025 <a href="https://device-info.hamusata.f5.si" target="_blank" rel="noopener">device-info.hamusata.f5.si</a><br />
    使用ライブラリ: <a href="https://api.ipify.org" target="_blank" rel="noopener">ipify API</a>, JavaScript Web API<br />
    表示される情報は一部、正確でない可能性があります。
  </footer>

  <script>
    (function () {
      const dict = {
        ja: {
          title: "デバイス情報",
          os: "OS名",
          version: "バージョン",
          device: "端末名",
          browser: "ブラウザ",
          ua: "ユーザーエージェント",
          screen: "画面解像度",
          viewport: "ビューポート",
          colorDepth: "色深度",
          pixelDepth: "ピクセル深度",
          cpu: "CPUコア数",
          memory: "メモリ",
          ipv4: "IPv4アドレス",
          ipv6: "IPv6アドレス",
          ip: "現在使用IP",
          online: "オンライン状態",
          fetchedAt: "取得時刻",
          now: "現在時刻",
          timezone: "タイムゾーン"
        },
        en: {
          title: "Device Info",
          os: "OS",
          version: "Version",
          device: "Device",
          browser: "Browser",
          ua: "User Agent",
          screen: "Screen",
          viewport: "Viewport",
          colorDepth: "Color Depth",
          pixelDepth: "Pixel Depth",
          cpu: "CPU Cores",
          memory: "Memory",
          ipv4: "IPv4",
          ipv6: "IPv6",
          ip: "Current IP",
          online: "Online",
          fetchedAt: "Fetched At",
          now: "Now",
          timezone: "Timezone"
        }
      };

      let currentLang = 'ja';
      let darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;

      const table = document.getElementById('info');
      const favicon = document.getElementById('favicon');
      const btnJa = document.getElementById('btn-ja');
      const btnEn = document.getElementById('btn-en');
      const btnLight = document.getElementById('btn-light');
      const btnDark = document.getElementById('btn-dark');
      const titleEl = document.getElementById('title');

      // OS検出詳細
      function detectOS() {
        const ua = navigator.userAgent;
        if (/Android/.test(ua)) {
          const version = (ua.match(/Android\s+([\d.]+)/) || [])[1] || "不明";
          const model = (ua.match(/;\s?([^;\/]+)\s+Build/i) || [])[1] || "不明端末";
          return { name: "Android", version, device: model };
        }
        if (/iPhone|iPad|iPod/.test(ua)) {
          const version = (ua.match(/OS (\d+)[_.](\d+)/) || [])[1] || "不明";
          const model = /iPhone/.test(ua) ? "iPhone" : "iPad";
          return { name: model === "iPhone" ? "iOS" : "iPadOS", version, device: model };
        }
        if (/Windows NT/.test(ua)) {
          const ver = (ua.match(/Windows NT ([\d.]+)/) || [])[1];
          const map = {
            "10.0": "10 / 11",
            "6.3": "8.1",
            "6.2": "8",
            "6.1": "7",
            "6.0": "Vista",
            "5.1": "XP"
          };
          return { name: "Windows", version: map[ver] || ver, device: "PC" };
        }
        if (/Mac OS X/.test(ua)) {
          const version = (ua.match(/Mac OS X (\d+[_\.]\d+)/) || [])[1]?.replace(/_/g, ".") || "不明";
          return { name: "macOS", version, device: "Mac" };
        }
        if (/Linux/.test(navigator.platform)) {
          return { name: "Linux", version: "不明", device: "Linux端末" };
        }
        return { name: "不明", version: "不明", device: "不明" };
      }

      // ブラウザ名取得
      function getBrowser() {
        const ua = navigator.userAgent;
        if (/Edg\//.test(ua)) return "Microsoft Edge";
        if (/OPR\//.test(ua)) return "Opera";
        if (/Chrome\//.test(ua)) return "Chrome";
        if (/Firefox\//.test(ua)) return "Firefox";
        if (/Safari/.test(ua) && !/Chrome/.test(ua)) return "Safari";
        return "不明";
      }

      // 端末情報テーブル行作成
      function createRow(label, value) {
        const row = document.createElement('tr');
        row.innerHTML = `<th scope="row">${label}</th><td>${value}</td>`;
        return row;
      }

      async function updateInfo() {
        const lang = dict[currentLang];
        table.innerHTML = '';

        const ua = navigator.userAgent;
        const osInfo = detectOS();
        const browser = getBrowser();

        // IPv4
        const ipv4 = await fetch('https://api.ipify.org?format=json')
          .then(res => res.json())
          .then(data => data.ip)
          .catch(() => '取得失敗');

        // IPv6
        const ipv6 = await fetch('https://api64.ipify.org?format=json')
          .then(res => res.json())
          .then(data => data.ip)
          .catch(() => '取得失敗');

        // 現在接続IP（Cloudflareのエンドポイント、環境依存）
        const currentIP = await fetch('/cdn-cgi/trace')
          .then(res => res.text())
          .then(text => {
            const m = text.match(/ip=([^\n]+)/);
            return m ? m[1] : '取得失敗';
          })
          .catch(() => '取得失敗');

        // CPUコア数・メモリ
        const cpuCores = navigator.hardwareConcurrency || '不明';
        const memory = navigator.deviceMemory ? navigator.deviceMemory + ' GB' : '不明';

        // 画面・表示情報
        const screenRes = `${screen.width} x ${screen.height}`;
        const viewport = `${window.innerWidth} x ${window.innerHeight}`;
        const colorDepth = screen.colorDepth;
        const pixelDepth = screen.pixelDepth;

        // 日時
        const fetchedAt = new Date();
        const now = new Date();
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || '不明';

        const infoList = [
          [lang.os, osInfo.name],
          [lang.version, osInfo.version],
          [lang.device, osInfo.device],
          [lang.browser, browser],
          [lang.ua, ua],
          [lang.screen, screenRes],
          [lang.viewport, viewport],
          [lang.colorDepth, colorDepth],
          [lang.pixelDepth, pixelDepth],
          [lang.cpu, cpuCores],
          [lang.memory, memory],
          [lang.ipv6, ipv6],
          [lang.ipv4, ipv4],
          [lang.ip, currentIP],
          [lang.online, navigator.onLine ? (currentLang === 'ja' ? 'オンライン' : 'Online') : (currentLang === 'ja' ? 'オフライン' : 'Offline')],
          [lang.fetchedAt, fetchedAt.toLocaleString()],
          [lang.now, now.toLocaleString()],
          [lang.timezone, timezone]
        ];

        for (const [label, value] of infoList) {
          table.appendChild(createRow(label, value));
        }
      }

      function setLang(lang) {
        currentLang = lang;
        titleEl.textContent = dict[lang].title;
        btnJa.classList.toggle('active', lang === 'ja');
        btnEn.classList.toggle('active', lang === 'en');
        btnJa.setAttribute('aria-pressed', lang === 'ja');
        btnEn.setAttribute('aria-pressed', lang === 'en');
        updateInfo();
      }

      function setMode(isDark) {
        darkMode = isDark;
        document.body.classList.toggle('light', !darkMode);
        btnLight.classList.toggle('active', !darkMode);
        btnDark.classList.toggle('active', darkMode);
        btnLight.setAttribute('aria-pressed', !darkMode);
        btnDark.setAttribute('aria-pressed', darkMode);
        favicon.href = darkMode ? 'icon-dark.png' : 'icon-light.png';
      }

      // 現在時刻だけ1秒ごとに更新（秒単位で動かす）
      function updateCurrentTime() {
        const nowStr = new Date().toLocaleString();
        const rows = table.querySelectorAll('tr');
        for (const row of rows) {
          if (row.firstElementChild?.textContent === dict[currentLang].now) {
            row.lastElementChild.textContent = nowStr;
            break;
          }
        }
      }

      btnJa.addEventListener('click', () => setLang('ja'));
      btnEn.addEventListener('click', () => setLang('en'));
      btnLight.addEventListener('click', () => setMode(false));
      btnDark.addEventListener('click', () => setMode(true));

      // 初期セットアップ
      setMode(darkMode);
      setLang(currentLang);
      updateInfo();

      // 情報は1分ごとに更新（IPなどの変化に対応）
      setInterval(updateInfo, 60000);

      // 現在時刻は1秒ごとに更新
      setInterval(updateCurrentTime, 1000);
    })();
  </script>
</body>
</html>
